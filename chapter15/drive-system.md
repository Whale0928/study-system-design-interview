## Google drive system

**드라이브 시스템과 강한 일관성 동기화의 중요성**    
  
현대 드라이브 시스템은 데이터를 안전하고 효율적으로 관리하는 데 필수적인 역할을 한다. 
이 글에서는 드라이브 시스템의 핵심 기능과 이를 가능하게 하는 기술적 요소들을 살펴보려 한다. 

특히, '강한 일관성 동기화'라는 개념과 블록이라는개념에 주목할 것이다. 

강한 일관성 동기화는 모든 사용자가 언제나 최신의 데이터 상태를 볼 수 있도록 하는 시스템의 능력이다. 
이는 데이터의 정확성과 신뢰성을 유지하는 데 중요하다.

### 드라이브 시스템들의 핵심 기능

- 파일 추가, 다운로드, 갱신 이력 관리
- 파일 공유와 변동 알림

### 고려할 점

- 사용자에게 할당되는 무료 저장 공간

  
-----  
 
## 단일 서버극복

이런 파일 저장소의 특성 때문에 용량이 매우 중요하다. 그러나 이런 용량을 갖추면서 일관성을 보장하는 서비스를 모두 갖추는 건 사실상 불가능하다.

**데이터 샤딩**

- 데이터를 샤딩해서 관리하는 방법이 있다. 샤딩은 데이터를 여러 서버에 분산하여 저장하는 것으로, 
- 이를 통해 데이터 관리의 효율성을 높일 수 있다. 
- 예를 들어 아마존의 S3, 네이버의 Object Storage, GCP의 Cloud Storage와 같은 다양한 클라우드 기반 버킷 스토리지를 사용하는 것이 좋다.


 ![onDBGnX.png](https://i.imgur.com/onDBGnX.png)

 **단일 서버극복**
-  **데이터 중복성**: 중요한 데이터는 여러 서버에 복제하여 저장함으로써, 한 서버에 문제가 발생해도 데이터 손실을 방지한다.
- **로드 밸런싱**: 사용자 요청을 여러 서버에 분산시켜, 특정 서버에 과부하가 걸리지 않도록 한다.
- **정기적인 백업**: 데이터를 정기적으로 백업하여, 문제 발생 시 신속한 복구가 가능하게 한다.


 > 이런 용량을 챙기면서 일관성을 보장하는 서비스를 모두 구축하는건 불가능  
   
1. **확장성**
    - 클라우드는 서버의 복제와 확장이 매우 자유롭다. 필요에 따라 저장 공간과 처리 능력을 유연하게 조절할 수 있다.
2. **고가용성**
    - 클라우드 서비스는 여러 위치에 데이터를 분산 저장하여, 한 지점에 문제가 생겨도 서비스가 중단되지 않는다.
3. **내구성**
    - 데이터 손상이나 손실을 방지하기 위해 클라우드는 여러 복제본을 저장한다.
4. **비용 효율성**
    - 실제 사용한 만큼만 비용을 지불하는 구조로, 불필요한 자원 낭비를 줄일 수 있다.
5. **유지보수 용이성**
    - 클라우드 제공업체가 서버 유지보수를 담당하여, 사용자는 관리에 드는 시간과 비용을 절약할 수 있다.
6. **보안**
    - 클라우드 제공업체들은 데이터 보안과 관련된 최신 기술을 적용하여 사용자 데이터를 안전하게 보호한다.
7. **재해 복구**
    - 데이터를 여러 위치에 분산하여 저장함으로써 자연 재해나 기타 재해로부터 데이터를 보호한다.
8. **글로벌 접근성**
    - 인터넷이 연결된 어디서나 데이터에 접근할 수 있다.

따라서 많은 양의 데이터를 다룰 때 클라우드 서비스를 사용하는 것이 바람직하다.

  -----
## 동기화 문제

드라이브 시스템에서 동기화는 매우 중요하다.
특히, 파일 시스템에서는 이전 시스템과는 다른 동기화 방법이 필요하다. 강한 일관성을 보장하기 위해, 다음과 같은 접근 방식을 사용한다:

- **순차적 처리** 
- 변경이 먼저 처리되면 성공한 것으로 간주하고, 나중에 처리되는 변경은 충돌이 발생한 것으로 간주한다.
- **버전 관리** 
- 파일의 여러 버전을 관리하여, 충돌이 발생할 경우 사용자가 어떤 버전을 유지할지 선택할 수 있게 한다.

또한, 오류 발생 시 시스템 내에는 같은 파일의 두 가지 버전이 존재할 수 있다. 
이는 사용자에게 선택의 여지를 주며, 다음과 같은 두 버전이 될 수 있다:
이건 우리가 깃허브에 푸쉬 할 때  충돌과 매우 유사하다.

- 사용자가 가지고 있는 로컬 사본
- 서버에 저장된 최신 버전

이러한 상황에서 사용자는 두 파일을 하나로 합치거나, 둘 중 하나를 선택하여 다른 파일로 대체하는 결정을 내려야 한다. 이 과정은 사용자에게 유연성을 제공하며, 동시에 데이터 일관성을 유지하는 데 중요하다.

------

## 서버 구조 
  
  
![](https://i.imgur.com/DWZpjm5.png)  
  
  
- **사용자 단말**: 웹브라우저나 모바일 앱을 포함한 클라이언트.  
- **블록 저장소 서버**: 파일 블록을 클라우드 저장소에 업로드하는 서버.  
- **클라우드 저장소**: 온라인 데이터 저장 공간.  
- **아카이빙 저장소**: 장기간 비활성화된 데이터를 저장하는 곳.  
- **로드밸런서**: 트래픽 분산 및 시스템 균형 유지.  
- **API 서버**: 애플리케이션 프로그래밍 인터페이스를 통한 시스템 접근 및 관리.  
- **메타데이터 데이터베이스**: 파일 메타데이터 관리.  
- **알림 서비스**: 사용자에게 시스템의 변동사항을 알리는 서비스.  
- **오프라인 사용자 백업 큐**: 오프라인 상태의 사용자를 위한 백업 및 동기화 큐.  
  
> **파일 블럭**이라는 말이 나오는데 큰 용량의 파일은 관리가 용이하도록 > 일정한 크기로 분할한 것을 의미한다.   
> 고정된 크기 : 4kb , 8kb등 일정한 사이즈를 관리한다.  
> 관리를 용이하게 할 수 있고 유실 될 경우에 추적이 더 편해진다.  
> 저장 공간을 효율적으로 활용할 수 있다.   
  
1. **직렬화**: 파일은 먼저 바이트 코드로 직렬화 된다.   
   이 과정에서 파일의 내용이 바이트의 연속으로 변환되어 컴퓨터가 이해할 수 있는 형태로 저장된다.  
      
2. **블록 단위 분할**: 이 바이트 스트림은 그 다음에 파일 시스템이나 저장 시스템에 정의된 블록 크기에 따라 여러 개의 블록으로 나누어진다. 예를 들어, 블록 크기가 4KB라면, 100MB 크기의 파일은 대략 25,000개의 4KB 블록으로 나누어진다.  
      
3. **블록 관리**: 각각의 블록은 독립적으로 관리된다. 이는 파일의 일부만 변경되거나 업데이트되는 경우, 해당 부분에 해당하는 블록만 처리하면 되기 때문에 전체 파일을 다루는 것보다 효율적이다.  
      
4. **저장 및 접근**: 나누어진 블록들은 클라우드 저장소나 다른 저장 매체에 저장된다. 사용자가 파일에 접근할 때, 필요한 블록만을 불러와 전체 파일을 재구성합니다.  
  
  
------  
  
## 블록 저장소의 관리

드라이브 시스템에서 파일을 **효율적으로** 관리하기 위해 '블록 저장소' 개념이 중요하다. 
블록 저장소는 파일을 일정한 크기의 블록으로 나누어 저장하는 방식을 말한다. 
이 방법은 다음과 같은 장점을 제공한다:

- **효율적인 관리와 검색**: 
	- 파일이 블록 단위로 나뉘어져 있기 때문에, 필요한 부분만 빠르게 검색하고 접근할 수 있다.
- **데이터 복구 용이성**: 
	- 파일의 일부가 손상되었을 경우, 해당 블록만을 복구하면 되므로 전체 파일을 복구하는 것보다 효율적이다.
- **저장 공간 최적화**: 
	- 파일을 블록 단위로 관리함으로써, 저장 공간을 더 효율적으로 사용할 수 있다.
  
데이터는 다음과 같은 과정을 통해 블록 저장소에 저장된다:

1. **직렬화**: 파일은 먼저 바이트 코드로 직렬화되어, 컴퓨터가 이해할 수 있는 형태로 변환된다.
2. **블록 단위 분할**: 이 바이트 스트림은 파일 시스템이나 저장 시스템에 정의된 블록 크기에 따라 여러 개의 블록으로 나누어진다.
3. **블록 관리**: 각각의 블록은 독립적으로 관리되며, 이는 파일의 일부만 변경되거나 업데이트되는 경우 전체 파일을 다루는 것보다 효율적이다.
4. **저장 및 접근**: 나누어진 블록들은 클라우드 저장소나 다른 저장 매체에 저장되며, 사용자가 파일에 접근할 때 필요한 블록만을 불러와 전체 파일을 재구성한다.

이러한 방식으로 드라이브 시스템은 대용량 파일을 효율적으로 관리하고, 
사용자에게 빠른 데이터 접근을 제공한다.
  
-----  
  
## 객체 저장소와 블록 저장소의 비교   
  
드라이브 시스템에서는 두 가지 주요한 데이터 저장 방식이 사용된다
객체 저장소(Object Storage)와 블록 저장소(Block Storage). 이 두 저장 방식의 차이점을 이해하는 것은 중요하다.
  
아마존에서 바로 알려주는데  
  
![](https://i.imgur.com/04tgJ3K.png)  
  
  
  
한마디로 저장 방식과  파일 하나에 대하는 방식에서 차이가 난다.  
  
객체 스토리지는 비정형 데이터의 저장과 관리에 적합.  
블록 스토리지는 대용량 파일의 효율적인 관리와 동기화에 적합한 형태의 데이터를 저장하는 데 적합.  

### 객체 저장소(Object Storage)

- **비정형 데이터 관리에 적합**: 이미지, 비디오, 문서 등 비정형 데이터를 저장하는 데 적합하다.
- **확장성 높음**: 객체 저장소는 무한한 확장성을 제공한다. 데이터는 글로벌 네임스페이스 내에서 관리되며, 어디서나 접근 가능하다.
- **메타데이터 관리**: 각 객체에는 메타데이터가 포함되어 있어, 데이터에 대한 추가 정보를 저장할 수 있다.

### 블록 저장소(Block Storage)

- **고정된 데이터 블록 관리에 적합**: 일정한 크기의 데이터 블록을 관리하는 데 적합하다.
- **성능 및 효율성 높음**: 데이터가 고정된 크기의 블록으로 나뉘어 있기 때문에, 검색 및 접근이 빠르다.
- **유연한 활용성**: 운영 체제 설치, 데이터베이스 관리 등 다양한 용도로 사용할 수 있다.
  
>객체 저장소는 비정형 데이터를 다루는 데 최적화되어 있다. 
>블록 저장소는 더 전통적인 데이터 저장 방식으로, 특히 데이터베이스 및 운영 체제 저장에 적합하다.

------  
  
  
## 강한 일관성의 중요성

드라이브 시스템에서 데이터의 일관성은 사용자 경험과 시스템 신뢰성에 매우 중요한 역할을 한다. 
특히 '강한 일관성(Strong Consistency)'은 시스템이 어떠한 상황에서도 데이터의 정확성을 보장하는 것을 의미한다. 

강한 일관성의 주요 특징은 다음과 같다:

1. **데이터의 실시간 동기화**: 모든 사용자는 어떠한 시점에서든 최신 상태의 데이터를 볼 수 있다.
2. **데이터 충돌 방지**: 강한 일관성을 통해 데이터 변경 시 충돌을 방지하고, 모든 사용자에게 동일한 데이터를 제공한다.
3. **시스템 신뢰도 증가**: 사용자는 언제나 정확하고 최신의 데이터를 기대할 수 있어, 시스템에 대한 신뢰도가 증가한다.
  

  
- 간략 업로드 절차 

![](https://i.imgur.com/LyoHn52.png)  
  
  
다운로드 절차는 업로드 절차와 달리 매우 직관적이여서 바로 알 수 있다  

![](https://i.imgur.com/JxVNWhj.png)  
  
  
---------  
  
  
### 알림 서비스   
>알림 서비스라는 말이 아까부터 간간히 등장하는데  
>강한 일관성을 보장하기 위한 방법 중 하나다.  
  
  
여기서 프로토콜에 대해 말을 하는데  
우리가 저번 주에 말했지만 롱 폴링을 사용한다.  
이유는 살짝 다르긴 하다 자원의 아까움 등의 이유도 있지만.  
가장 큰 이유는 **양방향 통신이 필요 없어서** 이다  
  
끊는 방식도 직관적인데 롱폴링 통신 중 변동이 감지 되면 응답이 오면서 
자동으로 끊어지기 때문에  처리도 간단하다.  
  
  
-----